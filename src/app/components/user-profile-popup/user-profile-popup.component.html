@let name = this.userForm.get("name");
@let lastName = this.userForm.get("lastName");
@let email = userForm.get("email");
@let card = cardForm.get("card");
@let data = cardForm.get("data");
@let cvv = cardForm.get("cvv");

<stepper [stepperData]="stepperData"></stepper>

<div class="popup__down">
  @if (step === RegistrationStep.PERSONAL_INFO) {
    <h3>Персональные данные:</h3>
    <form [formGroup]="userForm">
      <div class="popup__down--name">
        <span>Имя</span>
        <input-text
          formControlName="name"
          placeholder="Введите имя"
        ></input-text>
        @if (name?.invalid && (name?.dirty || name?.touched)) {
          @if (name?.errors?.["required"]) {
            <span class="spanErr">Обязательное поле</span>
          }
          @if (name?.errors?.["minlength"]) {
            <span class="spanErr">В поле не менее {{ 3 }} символов</span>
          }
          @if (name?.errors?.["numbersInName"]) {
            <span class="spanErr">Некорректное имя</span>
          }
        }
      </div>

      <div class="popup__down--lastName">
        <span>Фамилия</span>
        <input-text
          formControlName="lastName"
          placeholder="Введите фамилию"
        ></input-text>
        @if (lastName?.invalid && (lastName?.dirty || lastName?.touched)) {
          @if (lastName?.errors?.["required"]) {
            <span class="spanErr">Обязательное поле</span>
          }
          @if (lastName?.errors?.["minlength"]) {
            <span class="spanErr">В поле не менее {{ 2 }} символов</span>
          }
          @if (lastName?.errors?.["numbersInName"]) {
            <span class="spanErr">Некорректное имя</span>
          }
        }
      </div>

      <div class="popup__down--email">
        <span>E-mail</span>
        <input-text
          formControlName="email"
          placeholder="Введите E-mail"
        ></input-text>
        @if (email?.invalid && (email?.dirty || email?.touched)) {
          @if (email?.errors?.["required"]) {
            <span class="spanErr">Обязательное поле</span>
          }
          @if (email?.errors?.["numbersInName"]) {
            <span class="spanErr">Некорректное имя</span>
          }
        }
      </div>

      <span>Страна</span>
      <dropdown
        formControlName="country"
        [defaultValue]="countryDefaultValue"
        [dropdownItems]="countryDropdownItems"
      ></dropdown>

      <span>Город</span>
      <dropdown
        formControlName="city"
        [defaultValue]="cityDefaultValue"
        [dropdownItems]="cityDropdownItems"
      ></dropdown>
    </form>
  }

  @if (step === RegistrationStep.ACCOUNT_TYPE) {
    <custom-check-box
      [radioConfig]="radioButtonConfig"
      (userConfiture)="userChoice($event)"
    ></custom-check-box>
  }

  @if (step === RegistrationStep.PAYMENT_DETAILS) {
    <h3>Введите данные вашей карты</h3>
    <form [formGroup]="cardForm">
      <span>Номер карты</span>
      <input-text
        formControlName="card"
        type="text"
        mask="0000 0000 0000 0000"
        placeholder="**** **** **** ****"
      ></input-text>
      @if (card?.invalid && (card?.dirty || card?.touched)) {
        @if (card?.errors?.["required"]) {
          <span class="spanErr">Обязательное поле</span>
        }
        @if (card?.errors?.["numbersInName"]) {
          <span class="spanErr">Некорректное имя</span>
        }
      }
      <div class="card-data-cvc">
        <div class="card-data">
          <span>Месяц/год</span>
          <input-text
            formControlName="data"
            type="text"
            mask="M0/00"
            placeholder="00/00"
          ></input-text>
          @if (data?.invalid && (data?.dirty || data?.touched)) {
            @if (data?.errors?.["required"]) {
              <span class="spanErr">Обязательное поле</span>
            }
            @if (data?.errors?.["minlength"]) {
              <span class="spanErr">В поле не менее {{ 4 }} символов</span>
            }
            @if (data?.errors?.["numbersInName"]) {
              <span class="spanErr">Некорректное имя</span>
            }
          }
        </div>
        <div class="card-cvc">
          <span>CVC/CVV-код</span>
          <input-text
            formControlName="cvc"
            placeholder="***"
            type="password"
          ></input-text>
          @if (cvv?.invalid && (cvv?.dirty || cvv?.touched)) {
            @if (cvv?.errors?.["required"]) {
              <span class="spanErr">Обязательное поле</span>
            }
            @if (cvv?.errors?.["numbersInName"]) {
              <span class="spanErr">Некорректное имя</span>
            }
          }
        </div>
      </div>
    </form>
  }

  <div class="button" [class.twoBTN]="step > 0">
    @if (step > 0) {
      <app-buttons
        [text]="buttonBack.text"
        [borderStyle]="buttonBack.borderStyle"
        (click)="lastStep()"
      ></app-buttons>
    }

    <app-buttons
      [text]="buttonNext.text"
      [borderStyle]="buttonNext.borderStyle"
      (click)="nextStep()"
    ></app-buttons>
  </div>
</div>
